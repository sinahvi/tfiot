'use strict';const zlib=require('zlib');module.exports=(a,b='')=>new Promise((c,d)=>{console.log(`MODULE SW_REST_STREAM HOST${a.host}:${a.port} SENC${a.senc} RENC${a.renc} ${b.length}`),'https'===a.prot&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED='0');const e=require(a.prot).request({host:a.host,port:a.port,method:a.method,path:a.path,headers:{Accept:'application/json',Authorization:'Basic '+a.auth,"x-encoding":a.senc?'deflate':'',"accept-encoding":a.renc?'deflate':''}},(b)=>{let e=new require('stream').Writable(),f=[],g=0;e.write=(a)=>{f.push(a),g+=a.length},e.on('error',(a)=>{d('WS-Error: '+a.message)}),e.on('finish',()=>{let a=Buffer.alloc(g);for(let b=0,c=f.length,d=0;b<c;b++)f[b].copy(a,d),d+=f[b].length;c(a.toString())}),a.renc?b.pipe(zlib.createInflate()).pipe(e):b.pipe(e)});e.on('error',(a)=>{d('X-Error: '+a.message)});let f=new require('stream').Readable();f.push(b),f.push(null),a.senc?f.pipe(zlib.createDeflate()).pipe(e):f.pipe(e)});
